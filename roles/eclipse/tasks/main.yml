---

 - name: ensure group eclipse exists
   become: yes
   ansible.builtin.group:
    name: eclipse
    state: present

 - name: add the user {{ ansible_user }} to eclipse group
   become: yes
   ansible.builtin.user:
    name: "{{ ansible_user }}"
    groups: eclipse
    append: true

 - name: determine if eclipse already installed
   stat:
      path: "{{ eclipse_install_dir }}/{{ eclipse_version }}"
   register: eclipse_installed
   changed_when: false

 - name: create installation directory
   become: yes
   ansible.builtin.file:
    path: "{{ eclipse_install_dir }}/{{ eclipse_version }}"
    state: directory
    owner: root
    group: eclipse
    mode: 0775

 - name: download and unpack eclipse
   become: yes
   unarchive:
     src: "{{ eclipse_download_url }}"
     dest: "{{ eclipse_install_dir }}/{{ eclipse_version }}"
     extra_opts: [--strip-components=1]
     owner: root
     group: eclipse
     mode: 0775
     remote_src: yes
   changed_when: false
   when: not eclipse_installed.stat.exists

 - name: create symbolic link
   become: yes
   file:
     src: "{{ eclipse_install_dir }}/{{ eclipse_version }}"
     path: "/opt/eclipse"
     owner: root
     group: eclipse
     state: link
     mode: 0755
   when: not eclipse_installed.stat.exists

 - name: Set Xms value in ini file
   become: yes
   lineinfile:
     dest: "/opt/eclipse/eclipse.ini"
     regexp: "^-Xms"
     line: "-Xms512m"

 - name: Set Xmx value in ini file
   become: yes
   lineinfile:
     dest: "/opt/eclipse/eclipse.ini"
     regexp: "^-Xmx"
     line: "-Xmx2048m"

 - name: create symbolic link
   become: yes
   file:
     src: "/opt/eclipse/eclipse"
     path: "/usr/local/sbin/eclipse"
     owner: root
     group: eclipse
     state: link
     mode: 0755

 - name: add eclipse shortcut
   become: yes
   template:
     src: eclipse.desktop.j2
     dest: /usr/share/applications/Eclipse.desktop
