---

 - name: add repository
   become: yes
   apt_repository:
     repo: ppa:git-core/ppa
     codename: "{{ ubuntu_codename }}"
     state: present
     update_cache: yes

 - name: install git
   become: yes
   apt:
     name: "{{ packages }}"
     state: present
   vars:
     packages:
     - git
     - gitk

 - name: install bash-completion
   become: yes
   apt:
     name: bash-completion
     state: present

 - name: download git completion
   become: yes
   get_url:
     url: https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash
     dest: /etc/bash_completion.d/git-completion
     mode: 0444

 - name: download git-flow completion
   become: yes
   get_url:
     url: https://raw.githubusercontent.com/bobthecow/git-flow-completion/master/git-flow-completion.bash
     dest: /etc/bash_completion.d/git-flow-completion
     mode: 0444

 - name: install pre-commit
   pip:
     name: pre-commit
     state: present

 # git-mkver
 - name: create temporary file for git-mkver download
   tempfile:
     state: file
     suffix: temp
   register: git_mkrev_download_tmp

 - name: download git-mkver binary
   get_url:
     url: "{{ git_mkrev_url }}"
     dest: "{{ git_mkrev_download_tmp.path }}"
     force: yes
   changed_when: false

 - name: extract git-mkver from archive
   become: yes
   unarchive:
     src: "{{ git_mkrev_download_tmp.path }}"
     dest: /usr/local/bin
     remote_src: yes
     mode: 0755

# Gitleaks
 - name: create temporary file for gitleaks download
   tempfile:
     state: file
     suffix: temp
   register: gitleaks_download_tmp

 - name: download gitleaks binary
   become: yes
   get_url:
     url: "{{ gitleaks_url }}"
     dest: "{{ gitleaks_download_tmp.path }}"
     force: yes
   changed_when: false

 - name: extract gitleaks from archive
   become: yes
   unarchive:
     src: "{{ gitleaks_download_tmp.path }}"
     dest: /usr/local/bin
     remote_src: yes
     mode: 0755