---
 - name: ensure group stoplight exists
   become: yes
   ansible.builtin.group:
     name: stoplight
     state: present

 - name: add the user {{ ansible_user }} to stoplight group
   become: yes
   ansible.builtin.user:
     name: "{{ ansible_user }}"
     groups: stoplight
     append: true

 - name: create install directory
   become: true
   ansible.builtin.file:
     path: "{{ stoplight_install_dir }}"
     state: directory
     owner: root
     group: stoplight
     mode: 0755

 - name: download stoplight
   become: true
   get_url:
     url: "{{ stoplight_download_url }}"
     dest: "{{ stoplight_install_dir }}/stoplight"
     owner: root
     group: stoplight
     mode: 0755

 - name: create symbolic link
   become: yes
   ansible.builtin.file:
     src: "{{ stoplight_install_dir }}/stoplight"
     path: "/usr/local/bin/stoplight"
     state: link

 - name: add stoplight shortcut
   become: yes
   template:
     src: stoplight.desktop.j2
     dest: /usr/share/applications/Stoplight.desktop
