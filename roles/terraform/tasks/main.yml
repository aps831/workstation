---
 # tfenv
 - name: create tfenv folder
   file:
     path: "{{ tfenv_install_dir }}"
     state: directory
     mode: 0755
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"

 - name: install tfenv
   git:
   args:
     repo: "https://github.com/tfutils/tfenv.git"
     dest: "{{ tfenv_install_dir }}"

 - name: ensure user profile directory exists
   become: yes
   ansible.builtin.file:
     dest: /home/{{ ansible_user }}/.profile.d
     state: directory
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755

 - name: define tfenv variables
   become: yes
   template:
     src: user_tfenv.sh.j2
     dest: /home/{{ ansible_user }}/.profile.d/tfenv.sh
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755

# tflint
 - name: create temporary file for tflint download
   tempfile:
     state: file
     suffix: temp
   register: tflint_download_tmp

 - name: download tflint binary
   get_url:
     url: "{{ tflint_url }}"
     dest: "{{ tflint_download_tmp.path }}"
     force: yes
   changed_when: false

 - name: extract tflint from archive
   become: yes
   unarchive:
     src: "{{ tflint_download_tmp.path }}"
     dest: /usr/local/bin
     remote_src: yes
     mode: 0755

# terraform docs
 - name: create temporary file for terraform docs download
   tempfile:
     state: file
     suffix: temp
   register: terraform_docs_download_tmp

 - name: download terraform docs binary
   get_url:
     url: "{{ terraform_docs_url }}"
     dest: "{{ terraform_docs_download_tmp.path }}"
     force: yes
   changed_when: false

 - name: extract terraform doc from archive
   become: yes
   unarchive:
     src: "{{ terraform_docs_download_tmp.path }}"
     dest: /usr/local/bin
     remote_src: yes
     mode: 0755

# terraform docs
 - name: create temporary file for terraform docs download
   tempfile:
     state: file
     suffix: temp
   register: terraform_docs_download_tmp

 - name: download terraform docs binary
   get_url:
     url: "{{ terraform_docs_url }}"
     dest: "{{ terraform_docs_download_tmp.path }}"
     force: yes
   changed_when: false

 - name: extract terraform doc from archive
   become: yes
   unarchive:
     src: "{{ terraform_docs_download_tmp.path }}"
     dest: /usr/local/bin
     remote_src: yes
     mode: 0755

# tfsec
 - name: download tfsec binary
   become: yes
   get_url:
     url: "{{ tfsec_url }}"
     dest: /usr/local/bin/tfsec
     force: yes
   changed_when: false

 - name: make tfsec binary executable
   become: yes
   file:
     path: /usr/local/bin/tfsec
     state: file
     mode: 0755

# terragrunt
 - name: download terragrunt binary
   become: yes
   get_url:
     url: "{{ terragrunt_url }}"
     dest: /usr/local/bin/terragrunt
     force: yes
   changed_when: false

 - name: make terragrunt binary executable
   become: yes
   file:
     path: /usr/local/bin/terragrunt
     state: file
     mode: 0755