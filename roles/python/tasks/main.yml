---
 - name: install python
   become: yes
   apt:
     name: "{{ packages }}"
   vars:
     packages:
     - python3-apt
     - python3-distutils
     - python3-dev
     - python3-venv
     - python3-pip
     # pyenv dependencies
     - make
     - build-essential
     - libssl-dev
     - zlib1g-dev
     - libbz2-dev
     - libreadline-dev
     - libsqlite3-dev
     - wget
     - curl
     - llvm
     - libncursesw5-dev
     - xz-utils
     - tk-dev
     - libxml2-dev
     - libxmlsec1-dev
     - libffi-dev
     - liblzma-dev

# pyenv
 - name: test if pyenv already installed
   stat:
      path: "{{ pyenv_install_dir }}"
   register: pyenv_install
   changed_when: false

 - name: create pyenv folder
   become: yes
   file:
     path: "{{ pyenv_install_dir }}"
     state: directory
     mode: 0755
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"

 - name: install pyenv
   command: git clone https://github.com/pyenv/pyenv.git "{{ pyenv_install_dir }}"
   when: not pyenv_install.stat.exists

 - name: install pyenv-virtualenv
   command: git clone https://github.com/pyenv/pyenv-virtualenv.git {{ pyenv_install_dir }}/plugins/pyenv-virtualenv
   when: not pyenv_install.stat.exists

# python dependencies
 - name: install python dependencies
   pip:
    name:
     - setuptools
     - testresources
