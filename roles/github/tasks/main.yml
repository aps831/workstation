---

# gh
 - name: add github signing key
   become: yes
   apt_key:
     url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
     state: present

 - name: add github cli repository
   become: yes
   apt_repository:
     repo: deb [arch=amd64] https://cli.github.com/packages stable main
     filename: githubcli
     state: present

 - name: install packages
   become: yes
   apt:
     name: "{{ packages }}"
     state: present
   vars:
     packages:
     - gh

 - name: add bash completion
   become: yes
   ansible.builtin.copy:
     src: gh.sh
     dest: "/home/{{ ansible_user }}/.profile.d/"
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755

# act
 - name: create temporary file for act download
   tempfile:
     state: file
     suffix: temp
   register: act_download_tmp

 - name: download act binary
   get_url:
     url: "{{ act_download_url }}"
     dest: "{{ act_download_tmp.path }}"
     force: yes
   changed_when: false

 - name: extract act from archive
   become: yes
   unarchive:
     src: "{{ act_download_tmp.path }}"
     dest: /usr/local/bin
     include:
       - act
     remote_src: yes
     owner: root
     group: root
     mode: 0755
