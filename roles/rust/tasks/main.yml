---

 - name: fetch rustup
   ansible.builtin.uri:
     url: https://sh.rustup.rs
     return_content: yes
   register: rustup_installer

 - name: run rustup installer
   ansible.builtin.shell:
     cmd: sh -s -- -y --no-modify-path
     stdin: "{{ rustup_installer.content }}"

 - name: ensure user profile directory exists
   become: yes
   ansible.builtin.file:
     dest: /home/{{ ansible_user }}/.profile.d
     state: directory
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755

 - name: define rust variables
   become: yes
   template:
     src: user_rust.sh.j2
     dest: /home/{{ ansible_user }}/.profile.d/rust.sh
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755