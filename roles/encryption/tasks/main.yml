---
# Find fingerprint at https://launchpad.net/~yubico/+archive/ubuntu/stable
- name: Add yubico signing key
  become: true
  ansible.builtin.get_url:
    url: "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x990BD85D1C4F411ABC0ECE8DFA4EC8F2EE58CE0B"
    dest: /usr/share/keyrings/yubico-keyring.asc
    mode: "0644"
    force: true

- name: Add yubico/stable repository
  become: true
  ansible.builtin.apt_repository:
    repo: "deb [signed-by=/usr/share/keyrings/yubico-keyring.asc] https://ppa.launchpadcontent.net/yubico/stable/ubuntu {{ ubuntu_codename }} main"
    filename: jlbarriere68
    state: present

- name: Install encryption packages
  become: true
  ansible.builtin.apt:
    name: "{{ packages }}"
  vars:
    packages:
      - age
      - secure-delete
      - caja-seahorse
      - nemo-seahorse
      - gnupg2
      - gnupg-agent
      - gnupg-utils
      - pinentry-curses
      - keychain
      - pass
      - xclip
      - xsel
      - libpth20
      - libccid
      - libu2f-udev
      - libyubikey-udev
      - pcscd
      - pcsc-tools
      - scdaemon
      - libksba8
      - yubioath-desktop
      - yubikey-manager

- name: Install u2f rules
  become: true
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/Yubico/libu2f-host/master/70-u2f.rules
    dest: /etc/udev/rules.d/70-u2f.rules
    mode: "0755"

- name: Install switch smartcard script
  ansible.builtin.copy:
    src: switch-smartcard
    dest: /home/{{ ansible_user }}/.local/bin
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "0744"
