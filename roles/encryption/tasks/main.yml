---

 - name: add ppa repository for yubico
   become: yes
   apt_repository:
     repo: 'ppa:yubico/stable'
     codename: "{{ ubuntu_codename }}"

 - name: install encryption packages
   become: yes
   apt:
     name: "{{ packages }}"
   vars:
     packages:
     - secure-delete
     - nemo-seahorse
     - gnupg2
     - gnupg-agent
     - gnupg-utils
     - pinentry-curses
     - keychain
     - pass
     - xclip
     - xsel
     - libpth20
     - libccid
     - libu2f-udev
     - libyubikey-udev
     - pcscd
     - pcsc-tools
     - scdaemon
     - libksba8
     - yubioath-desktop
     - yubikey-manager

 - name: install u2f rules
   become: yes
   get_url:
    url: https://raw.githubusercontent.com/Yubico/libu2f-host/master/70-u2f.rules
    dest: /etc/udev/rules.d/70-u2f.rules
    mode: '0755'

 - name: install switch smartcard script
   ansible.builtin.copy:
     src: switch-smartcard
     dest: /home/{{ ansible_user }}/.local/bin
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0744
