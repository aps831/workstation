---
# Minikube
 - name: download minikube
   become: true
   get_url:
     url: "{{ minikube_download_url }}"
     checksum: "{{ minikube_checksum }}"
     dest: /usr/local/bin/minikube
     mode: 0755

# Lens
 - name: ensure group lens exists
   become: yes
   ansible.builtin.group:
    name: lens
    state: present

 - name: add the user {{ ansible_user }} to lens group
   become: yes
   ansible.builtin.user:
    name: "{{ ansible_user }}"
    groups: lens
    append: true

 - name: create install directory
   become: true
   ansible.builtin.file:
     path: "{{ lens_install_dir }}"
     state: directory
     owner: root
     group: lens
     mode: 0755

 - name: download lens
   become: true
   get_url:
     url: "{{ lens_download_url }}"
     dest: "{{ lens_install_dir }}/lens"
     owner: root
     group: lens
     mode: 0775

 - name: create symbolic link
   become: yes
   ansible.builtin.file:
     src: "{{ lens_install_dir }}/lens"
     path: "/usr/local/bin/lens"
     state: link

 - name: add lens shortcut
   become: yes
   template:
     src=lens.desktop.j2
     dest=/usr/share/applications/Lens.desktop

# Helm
 - name: download helm binary
   get_url:
     url: "{{ helm_download_url }}"
     dest: "{{ helm_download_tmp }}"
   changed_when: false

 - name: extract from archive
   become: yes
   unarchive:
     src: "{{ helm_download_tmp }}"
     dest: /tmp
     remote_src: yes

 - name: copy helm file to bin
   become: yes
   copy:
     src: /tmp/linux-amd64/helm
     dest: /usr/local/bin
     remote_src: yes
     mode: 0755

 - name: install helm secrets
   command: helm plugin install https://github.com/jkroepke/helm-secrets --version v{{ helm_secrets_version }}
   ignore_errors: yes

 - name: install helm diff
   command: helm plugin install https://github.com/databus23/helm-diff --version master
   ignore_errors: yes

 - name: download helmfile binary
   become: yes
   get_url:
     url: "{{ helmfile_download_url }}"
     dest: /usr/local/bin/helmfile
     mode: 0755

# Sops
 - name: install sops
   become: yes
   apt:
      deb: "{{ sops_download_url }}"

# Fluxcd
 - name: install fluxcd
   become: true
   shell: curl -s https://fluxcd.io/install.sh | sudo bash

# Kubeseal
 - name: download kubeseal
   become: yes
   get_url:
     url: "{{ kubeseal_download_url }}"
     dest: "/usr/local/bin/kubeseal"
     mode: 0755

# Kind
 - name: download kind
   become: yes
   get_url:
     url: "{{ kind_download_url }}"
     dest: "/usr/local/bin/kind"
     mode: 0755

