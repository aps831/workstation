---
 - name: create temporary build directory
   tempfile:
     state: directory
     suffix: build
   register: tmp_dir
   changed_when: false

 - name: download golang
   become: yes
   get_url:
     url: "{{ golang_download_url }}"
     checksum: "{{ golang_checksum }}"
     dest: "{{ tmp_dir.path }}"
     mode: 0755

 - name: unpack golang
   become: yes
   unarchive:
     src: "{{ tmp_dir.path }}/{{ golang_download_filename }}"
     dest: "{{ golang_install_dir }}"
     remote_src: yes

 - name: define global golang variables
   become: yes
   template:
     src: etc_golang.sh.j2
     dest: /etc/profile.d/golang.sh
     mode: 0755

 - name: ensure user profile directory exists
   become: yes
   ansible.builtin.file:
     dest: /home/{{ ansible_user }}/.profile.d
     state: directory
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755

 - name: define user golang variables
   become: yes
   template:
     src: user_golang.sh.j2
     dest: /home/{{ ansible_user }}/.profile.d/golang.sh
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: 0755