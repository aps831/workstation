---

 - name: download helm binary
   get_url:
     url: "{{ helm_download_url }}"
     dest: "{{ helm_download_tmp }}"
   changed_when: false

 - name: extract from archive
   become: yes
   unarchive:
     src: "{{ helm_download_tmp }}"
     dest: /tmp
     remote_src: yes

 - name: copy helm file to bin
   become: yes
   copy:
     src: /tmp/linux-amd64/helm
     dest: /usr/local/bin
     remote_src: yes
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: '0744'

 - name: install helm secrets
   command: helm plugin install https://github.com/jkroepke/helm-secrets --version {{ helm_secrets_version }}
   ignore_errors: yes

 - name: install helm diff   
   command: helm plugin install https://github.com/databus23/helm-diff --version master
   ignore_errors: yes

 - name: download helmfile binary
   become: yes
   get_url:
     url: "{{ helmfile_download_url }}"
     dest: /usr/local/bin/helmfile
     mode: '0777'
