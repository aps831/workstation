---

 - name: install libsecret
   become: yes
   apt:
     name: "{{ packages }}"
   vars:
     packages:
     - libsecret-tools

 - name: install script for mounting
   become: yes
   template:
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     mode: a+x
     src: mount_odin_local.sh.j2
     dest: /usr/local/bin/mount_odin_local.sh

 - name: add odin autostart
   template:
     owner: "{{ ansible_user }}"
     group: "{{ ansible_user }}"
     src: odin.desktop.j2
     dest: /home/{{ ansible_user }}/.config/autostart/odin.desktop

 - name: mount backups
   become: yes
   mount:
     path: /mnt/odin/backups
     src: //{{ nas_host }}/backups
     fstype: cifs
     opts: credentials=/home/{{ ansible_user }}/.smbcredentials,iocharset=utf8,sec=ntlm,vers=1.0
     state: "{{ nas_mounting }}"
